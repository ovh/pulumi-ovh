name: Test Maven central credentials

on:
  workflow_dispatch:
  push:
    branches: [ main ]

jobs:
  ossrh-auth-check:
    runs-on: ubuntu-latest

    steps:
      - name: Sanity check secrets presence
        run: |
          if [ -z "$OSSRH_USERNAME" ] || [ -z "$OSSRH_PASSWORD" ]; then
            echo "‚ùå OSSRH credentials not injected"
            exit 1
          fi
          echo "‚úÖ OSSRH credentials injected"
        env:
          OSSRH_USERNAME: ${{ vars.OSSRH_USERNAME }}
          OSSRH_PASSWORD: ${{ secrets.OSSRH_PASSWORD }}
          
      - name: Prepare workspace
        run: |
          mkdir creds-test && cd creds-test
        shell: bash

      - name: Test Maven / OSSRH credentials
        run: |
          echo "üîπ Testing Maven / OSSRH credentials..."
          mvn -B -DskipTests -Dgpg.skip=true deploy && echo "‚úÖ OSSRH credentials valid"
        env:
          OSSRH_USERNAME: ${{ vars.OSSRH_USERNAME }}
          OSSRH_PASSWORD: ${{ secrets.OSSRH_PASSWORD }}
          GPG_KEYNAME: ${{ secrets.JAVA_SIGNING_KEY_ID }}
          GPG_PASSPHRASE: ${{ secrets.JAVA_SIGNING_PASSWORD }}

